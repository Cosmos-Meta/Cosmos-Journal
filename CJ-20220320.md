# 切换的机制——CJ-202203020

## 用户态和内核态

涉及到OS经常听到说 内核态 和 用户态 ，起因 是为了 隔离和安全，但伴随着这个概念和实现，会有诸多变化的产生，我们在这里 思考下

首先 现在 os能 分态 源头是 硬件有支持，或者说 指令集 设计时就考虑了，特权极。

这机制就是在某个控制寄存器内设置某几个比特位，cpu会按指令集规范执行进入特殊状态。

但这还不太细节，要看这衍生出什么问题，我们单纯的 设置 寄存器 某几个 比特位是 没有 意义的，因为 这个 操作太 单薄了，无法达到我们的要求，这时候就会问，我们的要求是什么。

理论上，我们希望 在任何 特权态，运行的指令，可以无缝切换，就是有来有回

而单纯设置 比特 位 是不可以的

还需要什么呢，这又要看，计算机如何运作的。

简单看来，计算机 可以看作 离散时间内 在最小单位时间 拥有 一个状态，表现为 cpu中的寄存器上的值

我们 在 切换 时 ，记录 停止的状态 ，转入 另一个 状态，就好。

记录 状态 需要 用到 一些存储，但好像不需要持久化，暂用内存

这时候 ， 在 装入 另一个 特权极 时 ，保存 当前状态 的 cpu 寄存器 到 内存上 ，返回时 恢复，就 形成了 特权级切换。